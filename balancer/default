server {
    server_name  donnieslist.com;
 #   return 301 $scheme://www.donnieslist.com$request_uri;
return 301 https://$server_name$request_uri;
}
server {
    listen 80;
    listen 443 ssl;
    client_max_body_size 200M;
    server_name jenkins.donnieslist.com;

	ssl_certificate /etc/nginx/ssl/donnieslist.com.chained.crt;
    ssl_certificate_key /etc/nginx/ssl/donnieslist.key;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_prefer_server_ciphers on;
    ssl_ciphers 'EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH';

    location / {
        proxy_pass http://45.55.254.21:8080;
    }
}
server {
    listen 80;
    listen 443 ssl;
    client_max_body_size 200M;
    server_name www.donnieslist.com;
#    rewrite ^/(.*) https://donnieslist.com/$1 permanent;
    

	ssl_certificate /etc/nginx/ssl/donnieslist.com.chained.crt;
    ssl_certificate_key /etc/nginx/ssl/donnieslist.key;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_prefer_server_ciphers on;
    ssl_ciphers 'EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH';

     # assets caching
    location ~ ^/(uploads)/ {
       root /home/ubuntu/project/donnyslist/server/public;
       access_log  off;
       gzip_static on;
       gzip on;
       gzip_disable "msie6";
       gzip_vary on;
       gzip_proxied any;
       gzip_comp_level 6;
       gzip_buffers 16 8k;
       gzip_http_version 1.1;
       gzip_min_length 256;
       gzip_types text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript application/vnd.ms-fontobject application/x-font-ttf font/opentype image/svg+xml image/x-icon;
       
       expires     max;
       add_header  Cache-Control public;
       add_header  Last-Modified "";
       add_header  ETag "";
       open_file_cache          max=1000 inactive=500s;
       open_file_cache_valid    600s;
       open_file_cache_errors   on;
       break;
    }
       

    location / {
        if ($host !~* ^(www)) {
          rewrite ^/(.*)$ https://www.donnieslist.com/$1 permanent;
        }
        proxy_pass http://45.55.254.21:5000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
    }
    location /api {
        proxy_pass http://45.55.254.21:3000;
    }

    location /socket {
      proxy_pass http://45.55.254.21:3000;
    }

    root /var/www/html;
    index index.php index.html index.htm index.nginx-debian.html;

    location /jon {
        try_files $uri $uri/ =404;
    }

    location ~ \.php$ {
        include snippets/fastcgi-php.conf;
        fastcgi_pass unix:/run/php/php7.0-fpm.sock;
    }

    location /jenkins {
        proxy_pass http://45.55.254.21:8080;
    }

    # force https-redirects
    if ($scheme = http) {
        return 301 https://$server_name$request_uri;
    }

}

